# Contig Linkage Mapper

#### Quantify the rate of alternate contig linkages from whole-genome shotgun data by alignment

## Background

One of the challenges of analyzing _de novo_ assemblies of complex genomes is that mobile or repeated
genetic elements will often break assembly algorithms. In the context of metagenomic analysis, this
phenomenon is often observed for transposons, bacteriophages, and other elements which may be present
between different genomic flanking regions when comparing different microbial strains or isolates.
From the perspective of information content, mobile and repeated genetic elements will always present
a challenge for genomic and metagenomic analysis in any situation where the size of the genetic element
is longer than the length of the sequencing reads which can be generated.

While long-read sequencing is becoming increasingly accurate and affordable, short-read sequencing
platforms are extremely robust and mature. With long reads (e.g. >1kb), mobile elements can be linked
to flanking regions by identifying reads which span the junction with the adjacent genomic context.
With short reads, such linkage information is generated when the two ends of a sequenced molecule
are aligned on either side of the junction.

## Approach

The use-case which is targeted by this utility is when the user wishes to identify the amount of
evidence supporting the linkage of a single contig of interest to different adjacent genomic elements
across different biological specimens. The input data expected by this utility consists of:

1. Paired-end short-read whole-genome shotgun sequencing (WGS) datasets in FASTQ format
2. The DNA sequence of a single genetic element of interest in FASTA format
3. The DNA sequences of _de novo_ assembled contigs from the same specimens in FASTA format

Using this set of input data, this utility will:

a. Align WGS data (1) against both the target contig (2) and the larger assemblies (3)
b. Identify reads for which only one half of the pair is aligned to the contig of interest
c. Summarize the placement of the reads paired to those identified in (b) on contigs from the larger assembly (3)

### Inferring contig junction offset

The breakpoint of an assembly can have unresolved spacing of adjacent sequences. However, paired-end
sequencing data is often generated with a constrained distribution of DNA molecule lengths. That
distribution can be inferred from read alignment datasets based on the relative position of those
reads for which both ends align in the expected orientation to the same contig. By applying that
"insert size" data to the contig junction mapping, we can infer the general offset of a contig
junction which is supported by the available sequencing data.

The terminology which we will use for the "offset" of a contig junction is as follows:

- An offset of 0 indicates that the last/first base of the target contig is directly adjacent to
the last/first base of the adjacent contig
- An offset less than 0 indicates the number of bases which are inferred to overlap between
the adjacent contigs
- An offset greater than 0 indicates that the number of bases which are inserted to form
the junction between the adjacent contigs

## Output

The output generated by this utility will be summarized in terms of:

- The direction of the linkage, either from the 5' or 3' end of the target contig (2)
- The other contig which is identified as being linked from the larger assembly (3)
- The end of the other contig which is linked (either 5' or 3')
- The length of the linked contig
- The inferred contig junction offset
- The name of the specimen from which reads were detected supporting this junction
- The number of reads from that dataset which support this junction

NOTE: Reads which are consistent with a circular structure for the contig of
interest will be included in the output above, using the ID `self` for the linked contig.
The total size of the circular moledule can be inferred by applying the contig junction
offset to the contig length.

Other outputs which will be generated to help put the data in context are:

- The total number of reads from each specimen
- The number of reads from each specimen which aligned to the contig of interest

## Analysis Details

The workflow will take the approach of:

1. Align input reads to the contig of interest
2. Segment the aligned reads into those which:
- (2a) Align both ends in proper orientation
- (2b) Align both ends in outward-facing orientation (i.e., circular orientation)
- (2c) Align only one end to the target contig
3. Infer the per-specimen DNA insert size from (2a)
4. Align the other pair of the reads from (2c) to the larger set of _de novo_ assembled contigs (input 3, above)
5. Aggregate all contig linkage information and generate outputs
